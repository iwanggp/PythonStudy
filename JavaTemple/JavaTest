import android.app.Activity;
import android.content.Intent;
import android.os.Bundle;
import android.telephony.PhoneStateListener;
import android.telephony.TelephonyManager;
import android.widget.TextView;
public class A07Activity extends Activity {
 private TextView tv;//用来显示电话状态
 private String emailReceiver="16*****85@qq.com"; //邮箱地址
 private String emailSubject="你有来电信息，请查收！"; //作为邮件主题
  /** Called when the activity is first created. */
  @SuppressWarnings("static-access")
 @Override
  public void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    setContentView(R.layout.main);
    tv=(TextView)findViewById(R.id.tv);
    PhoneCallListener pcl=new PhoneCallListener();
    TelephonyManager tm=(TelephonyManager)getSystemService(TELEPHONY_SERVICE);
    tm.listen(pcl, pcl.LISTEN_CALL_STATE);
  }
  public class PhoneCallListener extends PhoneStateListener{
   public void onCallStateChanged(int state,String incomingNumber){ //需要重写onCallStateChanged方法
   switch(state){
   case TelephonyManager.CALL_STATE_IDLE:
    tv.setText("CALL_STATE_IDLE");
    break;
   case TelephonyManager.CALL_STATE_OFFHOOK:
    tv.setText("CALL_STATE_OFFHOOK");
    break;
   case TelephonyManager.CALL_STATE_RINGING:
    tv.setText("来电号码"+incomingNumber); //如果有人打来电话，就会自动发送邮件到邮箱通知用户来电号码
//设置来电时发送邮件
    Intent i=new Intent(android.content.Intent.ACTION_SEND);
    i.setType("plain/text");
    i.putExtra(android.content.Intent.EXTRA_EMAIL, new String[]{emailReceiver.toString()});
    i.putExtra(android.content.Intent.EXTRA_SUBJECT, emailSubject.toString());
    i.putExtra(android.content.Intent.EXTRA_TEXT, "来电电话"+incomingNumber);
    startActivity(Intent.createChooser(i, "来电信息"));
    break;
    default:
    break;
   }
   super.onCallStateChanged(state, incomingNumber);
   }
  }
}